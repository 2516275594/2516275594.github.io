<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>è·¨è®¾å¤‡æ–‡æœ¬ä¿å­˜å™¨</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .note-card {
      background: #f8f8f8;
      border-left: 5px solid #4CAF50;
      margin: 15px 0;
      padding: 15px 20px;
      border-radius: 4px;
    }
    .note-content {
      font-weight: bold;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ æ–‡æœ¬ä¿å­˜å™¨ï¼ˆè·¨è®¾å¤‡åŒæ­¥ï¼‰</h1>

  <form id="noteForm">
    <input type="text" id="mainText" placeholder="è¾“å…¥è¦ä¿å­˜çš„æ–‡æœ¬..." required>
    <input type="text" id="noteText" placeholder="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰">
    <select id="groupSelect">
      <option value="é»˜è®¤">é»˜è®¤</option>
      <option value="å·¥ä½œ">å·¥ä½œ</option>
      <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
      <option value="å­¦ä¹ ">å­¦ä¹ </option>
    </select>
    <button type="submit">ä¿å­˜</button>
  </form>

  <div id="notesContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = supabase.createClient(
      'https://ubsdjmcnonsormczvtuq.supabase.co', // æ›¿æ¢ä¸ºä½ çš„ Supabase é¡¹ç›® URL
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVic2RqbWNub25zb3JtY3p2dHVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NDA0ODQsImV4cCI6MjA3ODQxNjQ4NH0.ZGD7FkjFdKitHThi22ieZcRipPVgysdTkvowP-UNjAI' // æ›¿æ¢ä¸ºä½ çš„ Anon Key
    );

    // æ ¼å¼åŒ–æ—¥æœŸ
    function formatDate(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      const h = String(date.getHours()).padStart(2, '0');
      const min = String(date.getMinutes()).padStart(2, '0');
      return `${y}-${m}-${d} ${h}:${min}`;
    }

    // åŠ è½½æ‰€æœ‰ç¬”è®°
    async function loadNotes() {
      const { data, error } = await supabase.from('notes').select('*');
      if (error) {
        console.error('åŠ è½½ç¬”è®°å¤±è´¥:', error);
        return;
      }

      const container = document.getElementById('notesContainer');
      container.innerHTML = '';
      data.forEach(note => {
        const card = document.createElement('div');
        card.className = 'note-card';
        card.innerHTML = `
          <div class="note-content">${note.content}</div>
          ${note.remark ? `<div style="margin:8px 0;">å¤‡æ³¨ï¼š${note.remark}</div>` : ''}
          <div style="font-size:0.9em; color:#666;">ä¿å­˜æ—¶é—´ï¼š${formatDate(new Date(note.created_at))}</div>
        `;
        container.appendChild(card);
      });
    }

    // ä¿å­˜ç¬”è®°
    document.getElementById('noteForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const content = document.getElementById('mainText').value.trim();
      const remark = document.getElementById('noteText').value.trim();
      const group = document.getElementById('groupSelect').value;

      if (!content) {
        alert('è¯·è¾“å…¥è¦ä¿å­˜çš„æ–‡æœ¬å†…å®¹ï¼');
        return;
      }

      const { data, error } = await supabase.from('notes').insert([
        { content, remark, group_name: group }
      ]);

      if (error) {
        console.error('ä¿å­˜å¤±è´¥:', error);
        alert('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
      } else {
        await loadNotes();
        this.reset();
      }
    });

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', loadNotes);
  </script>
</body>
</html>
