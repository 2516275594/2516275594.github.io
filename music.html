<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>è·¨è®¾å¤‡æ–‡æœ¬ä¿å­˜å™¨</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    form {
      display: grid;
      grid-template-columns: 3fr 2fr 1fr;
      gap: 10px;
      margin-bottom: 20px;
    }

    input[type="text"] {
      padding: 10px;
      font-size: 16px;
    }

    button {
      padding: 10px;
      font-size: 16px;
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background: #45a049;
    }

    .note-card {
      background: #f8f8f8;
      border-left: 5px solid #4CAF50;
      margin: 15px 0;
      padding: 15px 20px;
      border-radius: 4px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .note-content {
      font-weight: bold;
      margin-bottom: 10px;
    }

    .note-footer {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      color: #666;
    }

    .delete-btn {
      color: red;
      cursor: pointer;
      font-weight: bold;
    }

    @media (max-width: 600px) {
      form {
        grid-template-columns: 1fr;
        gap: 8px;
      }

      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>ğŸ“ æ–‡æœ¬ä¿å­˜å™¨</h1>

  <form id="noteForm">
    <input type="text" id="mainText" placeholder="è¾“å…¥è¦ä¿å­˜çš„æ–‡æœ¬..." required />
    <input type="text" id="noteText" placeholder="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" />
    <select id="groupSelect">
      <option value="é»˜è®¤">é»˜è®¤</option>
      <option value="å·¥ä½œ">å·¥ä½œ</option>
      <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
      <option value="å­¦ä¹ ">å­¦ä¹ </option>
    </select>
    <button type="submit">ä¿å­˜</button>
  </form>

  <div>
    <label for="groupFilter">é€‰æ‹©åˆ†ç»„ï¼š</label>
    <select id="groupFilter">
      <option value="">å…¨éƒ¨</option>
      <option value="é»˜è®¤">é»˜è®¤</option>
      <option value="å·¥ä½œ">å·¥ä½œ</option>
      <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
      <option value="å­¦ä¹ ">å­¦ä¹ </option>
    </select>
  </div>

  <div id="notesContainer"></div>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // æ›¿æ¢ä¸ºä½ çš„ Supabase é¡¹ç›® URL å’Œ Anon Key
    const supabaseUrl = 'https://ubsdjmcnonsormczvtuq.supabase.co'; // æ›¿æ¢ä¸ºä½ çš„ Supabase é¡¹ç›® URL
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVic2RqbWNub25zb3JtY3p2dHVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NDA0ODQsImV4cCI6MjA3ODQxNjQ4NH0.ZGD7FkjFdKitHThi22ieZcRipPVgysdTkvowP-UNjAI'; // æ›¿æ¢ä¸ºä½ çš„ Anon Key

    const supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey);

    function formatDate(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      const h = String(date.getHours()).padStart(2, '0');
      const min = String(date.getMinutes()).padStart(2, '0');
      return `${y}-${m}-${d} ${h}:${min}`;
    }

    async function loadNotes(group = '') {
      let query = supabaseClient.from('notes').select('*');

      if (group) {
        query = query.eq('group_name', group);
      }

      const { data, error } = await query.order('created_at', { ascending: false });

      if (error) {
        console.error('åŠ è½½ç¬”è®°å¤±è´¥:', error);
        return;
      }

      const container = document.getElementById('notesContainer');
      container.innerHTML = '';

      data.forEach(note => {
        const card = document.createElement('div');
        card.className = 'note-card';

        card.innerHTML = `
          <div class="note-content">${note.content}</div>
          ${note.remark ? `<div style="margin:8px 0;">å¤‡æ³¨ï¼š${note.remark}</div>` : ''}
          <div class="note-footer">
            <span>ä¿å­˜æ—¶é—´ï¼š${formatDate(new Date(note.created_at))}</span>
            <span class="delete-btn" onclick="deleteNote('${note.id}')">åˆ é™¤</span>
          </div>
        `;

        container.appendChild(card);
      });
    }

    document.getElementById('noteForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const content = document.getElementById('mainText').value.trim();
      const remark = document.getElementById('noteText').value.trim();
      const group = document.getElementById('groupSelect').value;

      if (!content) {
        alert('è¯·è¾“å…¥è¦ä¿å­˜çš„æ–‡æœ¬å†…å®¹ï¼');
        return;
      }

      const { data, error } = await supabaseClient.from('notes').insert([
        { content, remark, group_name: group }
      ]);

      if (error) {
        console.error('ä¿å­˜å¤±è´¥:', error);
        alert('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
      } else {
        const selectedGroup = document.getElementById('groupFilter').value;
        await loadNotes(selectedGroup);
        this.reset();
      }
    });

async function deleteNote(id) {
  // å¼¹å‡ºå¯†ç è¾“å…¥æ¡†
  const inputPassword = prompt('è¯·è¾“å…¥åˆ é™¤å¯†ç ï¼š');

  // ç”¨æˆ·ç‚¹å‡»å–æ¶ˆæˆ–æœªè¾“å…¥
  if (inputPassword === null) return;

  // å»é™¤å‰åç©ºæ ¼å¹¶éªŒè¯å¯†ç 
  if (inputPassword.trim() !== 'jOjsDp0BDAYlGW2r') {
    alert('å¯†ç é”™è¯¯ï¼Œåˆ é™¤å·²å–æ¶ˆã€‚');
    return;
  }

  // å¯†ç æ­£ç¡®ï¼Œæ‰§è¡Œåˆ é™¤æ“ä½œ
  const { error } = await supabaseClient.from('notes').delete().eq('id', id);

  if (error) {
    console.error('åˆ é™¤å¤±è´¥:', error);
    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
  } else {
    // åˆ·æ–°ç¬”è®°åˆ—è¡¨ï¼ˆä¿æŒå½“å‰åˆ†ç»„ï¼‰
    const selectedGroup = document.getElementById('groupFilter').value;
    await loadNotes(selectedGroup);
  }
}

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('groupFilter').addEventListener('change', function () {
        const selectedGroup = this.value;
        loadNotes(selectedGroup);
      });

      loadNotes(); // åˆå§‹åŠ è½½æ‰€æœ‰ç¬”è®°
    });
  </script>
</body>
</html>


